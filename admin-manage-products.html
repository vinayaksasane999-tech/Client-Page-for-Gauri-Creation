<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Manage Products ‚Ä¢ Gauri Creations Admin</title>

<style>
  :root {
    --bg-grad: linear-gradient(135deg, #86e1ff, #ffd4b8);
    --glass-bg: rgba(255, 255, 255, 0.22);
    --glass-border: rgba(255, 255, 255, 0.45);
  }

  * { box-sizing: border-box; }

  body {
    margin: 0;
    min-height: 100vh;
    font-family: "Poppins", system-ui, sans-serif;
    background: var(--bg-grad);
    padding: 18px;
    color: #0f172a;
    display: flex;
    justify-content: center;
  }

  .shell { width: 100%; max-width: 1120px; }

  /* LOGIN OVERLAY */
  #loginOverlay {
    position: fixed;
    inset: 0;
    background: radial-gradient(circle at top, #ffffffdd, #000000bb);
    display: none;
    align-items: center;
    justify-content: center;
    z-index: 40;
  }

  .login-box {
    width: 90%;
    max-width: 320px;
    padding: 20px;
    background: rgba(15, 23, 42, 0.95);
    border-radius: 18px;
    color: #e5e7eb;
    text-align: center;
  }

  .login-box h2 { margin: 0 0 8px; font-size: 18px; }

  .login-input {
    width: 100%;
    margin-top: 10px;
    padding: 11px 13px;
    border-radius: 10px;
    border: 1px solid #4b5563;
    background: #020617;
    color: #e5e7eb;
    font-size: 14px;
  }

  .btn-primary-small {
    margin-top: 12px;
    padding: 10px 16px;
    border-radius: 999px;
    border: none;
    background: #22c55e;
    color: #022c22;
    font-weight: 600;
    cursor: pointer;
    font-size: 13px;
  }

  .error-msg {
    font-size: 12px;
    color: #fecaca;
    margin-top: 6px;
    display: none;
  }

  .small { font-size: 12px; color: #9ca3af; }

  /* TOP BAR */
  .topbar {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 10px 14px;
    border-radius: 20px;
    background: var(--glass-bg);
    border: 1px solid var(--glass-border);
    backdrop-filter: blur(18px);
    margin-bottom: 16px;
    box-shadow: 0 16px 40px rgba(15, 23, 42, 0.28);
  }

  .top-left {
    display: flex;
    align-items: center;
    gap: 10px;
  }

  .logo {
    width: 44px;
    height: 44px;
    border-radius: 14px;
    object-fit: cover;
  }

  .title-main { font-size: 18px; font-weight: 700; }
  .subtitle { font-size: 12px; color: #4b5563; }

  .top-right {
    display: flex;
    align-items: center;
    gap: 8px;
  }

  .pill-btn {
    padding: 6px 12px;
    border-radius: 999px;
    border: 1px solid #cbd5e1;
    background: #ffffffcc;
    font-size: 12px;
    cursor: pointer;
    text-decoration: none;
    color: #0f172a;
  }

  /* MAIN CARD */
  #adminMain { display: none; }

  .card {
    border-radius: 22px;
    background: rgba(255, 255, 255, 0.96);
    border: 1px solid rgba(148, 163, 184, 0.55);
    box-shadow: 0 18px 40px rgba(15, 23, 42, 0.35);
    padding: 14px;
  }

  .card-header {
    display: flex;
    justify-content: space-between;
    gap: 10px;
    flex-wrap: wrap;
    align-items: center;
    margin-bottom: 10px;
  }

  .card-header h2 { margin: 0; font-size: 18px; }

  .search-input {
    padding: 8px 10px;
    border-radius: 999px;
    border: 1px solid #cbd5e1;
    font-size: 13px;
    min-width: 200px;
  }

  .status-text {
    margin-top: 6px;
    font-size: 12px;
    color: #6b7280;
  }

  /* GRID */
  .grid {
    margin-top: 8px;
    display: grid;
    grid-template-columns: repeat(4, minmax(0, 1fr));
    gap: 10px;
  }

  @media (max-width: 1024px) {
    .grid { grid-template-columns: repeat(3, minmax(0, 1fr)); }
  }
  @media (max-width: 820px) {
    .grid { grid-template-columns: repeat(2, minmax(0, 1fr)); }
  }
  @media (max-width: 540px) {
    .grid { grid-template-columns: 1fr; }
  }

  .product-card {
    border-radius: 16px;
    background: #f9fafb;
    border: 1px solid #e5e7eb;
    overflow: hidden;
    display: flex;
    flex-direction: column;
  }

  .thumb {
    width: 100%;
    height: 150px;
    background: linear-gradient(135deg, #fee2e2, #e0f2fe);
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 32px;
    color: #9ca3af;
  }

  .thumb img {
    width: 100%;
    height: 100%;
    object-fit: cover;
  }

  .card-body {
    padding: 8px 10px 10px;
    display: flex;
    flex-direction: column;
    gap: 4px;
    font-size: 13px;
  }

  .prod-name { font-weight: 600; }
  .prod-sku { font-size: 11px; color: #6b7280; }
  .prod-price { font-weight: 700; color: #b91c1c; }

  .card-actions {
    display: flex;
    gap: 6px;
    margin-top: 6px;
  }

  .btn-small {
    flex: 1;
    padding: 6px 0;
    border-radius: 999px;
    border: 1px solid #cbd5e1;
    background: #ffffff;
    font-size: 12px;
    cursor: pointer;
  }

  .btn-small.danger {
    background: #fee2e2;
    border-color: #fecaca;
    color: #b91c1c;
  }

  /* EDIT MODAL */
  #editOverlay {
    position: fixed;
    inset: 0;
    background: rgba(15, 23, 42, 0.6);
    display: none;
    align-items: center;
    justify-content: center;
    z-index: 50;
  }

  .edit-box {
    width: 90%;
    max-width: 460px;
    background: #ffffff;
    border-radius: 18px;
    padding: 14px 16px 16px;
    box-shadow: 0 20px 40px rgba(15, 23, 42, 0.5);
  }

  .edit-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
  }

  .edit-header h3 { margin: 0; font-size: 16px; }

  .edit-close {
    border: none;
    background: transparent;
    font-size: 18px;
    cursor: pointer;
  }

  .field-label {
    font-size: 12px;
    color: #4b5563;
    margin-top: 6px;
  }

  .field {
    width: 100%;
    padding: 8px 10px;
    border-radius: 10px;
    border: 1px solid #cbd5e1;
    font-size: 13px;
  }

  textarea.field {
    min-height: 70px;
    resize: vertical;
  }

  .edit-footer {
    margin-top: 10px;
    display: flex;
    justify-content: space-between;
    gap: 8px;
    align-items: center;
    font-size: 12px;
    color: #6b7280;
  }

  .btn-save {
    padding: 8px 14px;
    border-radius: 999px;
    border: none;
    background: #16a34a;
    color: #ffffff;
    cursor: pointer;
    font-size: 13px;
    font-weight: 600;
  }
</style>
</head>

<body>
<div class="shell">

  <!-- LOGIN -->
  <div id="loginOverlay">
    <div class="login-box">
      <h2>Admin Login</h2>
      <p class="small">Enter your admin PIN to manage products.</p>
      <input id="adminPin" type="password" class="login-input" placeholder="Admin PIN" />
      <button id="loginBtn" class="btn-primary-small">Login</button>
      <div id="loginError" class="error-msg">Incorrect PIN. Try again.</div>
    </div>
  </div>

  <!-- MAIN -->
  <div id="adminMain">

    <header class="topbar">
      <div class="top-left">
        <img src="logo-gauri.jpeg" alt="Gauri Creations" class="logo" />
        <div>
          <div class="title-main">Manage Products</div>
          <div class="subtitle">Edit or remove products from your store.</div>
        </div>
      </div>
      <div class="top-right">
        <a href="admin.html" class="pill-btn">‚Üê Dashboard</a>
        <button class="pill-btn" onclick="reloadProducts()">Refresh</button>
        <button class="pill-btn" onclick="adminLogout()">Logout</button>
      </div>
    </header>

    <section class="card">
      <div class="card-header">
        <h2>Product List</h2>
        <input id="searchInput" class="search-input" placeholder="Search by name or SKU" />
      </div>

      <div id="statusText" class="status-text">Loading products‚Ä¶</div>

      <div id="grid" class="grid">
        <!-- product cards injected here -->
      </div>
    </section>
  </div>

  <!-- EDIT MODAL -->
  <div id="editOverlay">
    <div class="edit-box">
      <div class="edit-header">
        <h3 id="editTitle">Edit Product</h3>
        <button class="edit-close" onclick="closeEdit()">√ó</button>
      </div>

      <div>
        <div class="field-label">SKU (non-editable)</div>
        <input id="editSku" class="field" disabled />

        <div class="field-label">Name</div>
        <input id="editName" class="field" />

        <div class="field-label">Price (‚Çπ)</div>
        <input id="editPrice" type="number" class="field" />

        <div class="field-label">Length</div>
        <input id="editLength" class="field" />

        <div class="field-label">Width</div>
        <input id="editWidth" class="field" />

        <div class="field-label">Height</div>
        <input id="editHeight" class="field" />

        <div class="field-label">Weight</div>
        <input id="editWeight" class="field" />

        <div class="field-label">Image URL 1</div>
        <input id="editImg1" class="field" />

        <div class="field-label">Image URL 2</div>
        <input id="editImg2" class="field" />

        <div class="field-label">Image URL 3</div>
        <input id="editImg3" class="field" />

        <div class="field-label">Video URL</div>
        <input id="editVideo" class="field" />

        <div class="field-label">Description</div>
        <textarea id="editDesc" class="field"></textarea>
      </div>

      <div class="edit-footer">
        <span id="editStatus">Make changes and click Save.</span>
        <button class="btn-save" onclick="saveEdit()">Save</button>
      </div>
    </div>
  </div>

</div>

<script>
/* ============================
   ADMIN LOGIN
============================ */
const ADMIN_PIN = "1234";
const ADMIN_FLAG = "gc_admin_auth";

function initAdminLogin() {
  const overlay = document.getElementById("loginOverlay");
  const main = document.getElementById("adminMain");
  const btn = document.getElementById("loginBtn");
  const pin = document.getElementById("adminPin");
  const err = document.getElementById("loginError");

  if (localStorage.getItem(ADMIN_FLAG) === "yes") {
    overlay.style.display = "none";
    main.style.display = "block";
    reloadProducts();
  } else {
    overlay.style.display = "flex";
  }

  btn.onclick = function () {
    if (pin.value.trim() === ADMIN_PIN) {
      localStorage.setItem(ADMIN_FLAG, "yes");
      overlay.style.display = "none";
      main.style.display = "block";
      reloadProducts();
    } else {
      err.style.display = "block";
    }
  };
}

function adminLogout() {
  localStorage.removeItem(ADMIN_FLAG);
  location.href = "admin.html";
}

/* ============================
   CONFIG
============================ */
const SHEET_ID = "1W0CvU_5nbodRgwxfSNtNZ-eMUNFuVHqSG3vJ1UibJLw";
const PRODUCTS_SHEET = "Products";

// üî¥ IMPORTANT: put the SAME URL as in admin-add-product.html
const SCRIPT_URL =
  "https://script.google.com/macros/s/AKfycbxD6kFEU1QkcoX-ZFRz540bEPwaIECaST-Ogxq9UEs9LAnsx7Hq1yDzjkRTpmeaAL_j7A/exec";

let allProducts = [];
let currentEditSku = null;

/* ============================
   LOAD & RENDER PRODUCTS
============================ */
async function reloadProducts() {
  const statusEl = document.getElementById("statusText");
  const grid = document.getElementById("grid");
  grid.innerHTML = "";
  statusEl.textContent = "Loading products‚Ä¶";

  try {
    const res = await fetch(`https://opensheet.elk.sh/${SHEET_ID}/${PRODUCTS_SHEET}`);
    const data = await res.json();
    allProducts = data;
    renderProducts();
    statusEl.textContent = `Showing ${filteredProducts().length} of ${allProducts.length} products.`;
  } catch (err) {
    console.error(err);
    statusEl.textContent = "Error loading products. Please try again.";
  }
}

function filteredProducts() {
  const q = document.getElementById("searchInput").value.trim().toLowerCase();
  return allProducts.filter(row => {
    const sku = (row["SKU"] || "").toString().toLowerCase();
    const name = (row["Name"] || "").toString().toLowerCase();
    return sku.includes(q) || name.includes(q);
  });
}

function renderProducts() {
  const grid = document.getElementById("grid");
  grid.innerHTML = "";

  const rows = filteredProducts();
  rows.forEach(row => {
    const card = document.createElement("div");
    card.className = "product-card";

    const imageUrl =
      row["Image URL 1"] || row["ImageURL1"] || row["imageUrl1"] || "";

    const sku = row["SKU"] || "";
    const name = row["Name"] || "";
    const price = row["Price"] || "";

    const thumbDiv = document.createElement("div");
    thumbDiv.className = "thumb";

    if (imageUrl) {
      const img = document.createElement("img");
      img.src = imageUrl;
      thumbDiv.appendChild(img);
    } else {
      thumbDiv.textContent = "üõçÔ∏è";
    }

    const body = document.createElement("div");
    body.className = "card-body";

    body.innerHTML = `
      <div class="prod-name">${name || "(No name)"}</div>
      <div class="prod-sku">SKU: ${sku}</div>
      <div class="prod-price">‚Çπ${price || "0"}</div>
    `;

    const actions = document.createElement("div");
    actions.className = "card-actions";

    const btnEdit = document.createElement("button");
    btnEdit.className = "btn-small";
    btnEdit.textContent = "Edit";
    btnEdit.onclick = () => openEdit(row);

    const btnDelete = document.createElement("button");
    btnDelete.className = "btn-small danger";
    btnDelete.textContent = "Delete";
    btnDelete.onclick = () => deleteProduct(row);

    actions.appendChild(btnEdit);
    actions.appendChild(btnDelete);

    body.appendChild(actions);
    card.appendChild(thumbDiv);
    card.appendChild(body);
    grid.appendChild(card);
  });
}

/* ============================
   EDIT PRODUCT MODAL
============================ */
function openEdit(row) {
  currentEditSku = row["SKU"];

  document.getElementById("editSku").value = row["SKU"] || "";
  document.getElementById("editName").value = row["Name"] || "";
  document.getElementById("editPrice").value = row["Price"] || "";
  document.getElementById("editLength").value = row["Length"] || "";
  document.getElementById("editWidth").value = row["Width"] || "";
  document.getElementById("editHeight").value = row["Height"] || "";
  document.getElementById("editWeight").value = row["Weight"] || "";

  document.getElementById("editImg1").value =
    row["Image URL 1"] || row["ImageURL1"] || "";
  document.getElementById("editImg2").value =
    row["Image URL 2"] || row["ImageURL2"] || "";
  document.getElementById("editImg3").value =
    row["Image URL 3"] || row["ImageURL3"] || "";
  document.getElementById("editVideo").value =
    row["Video URL"] || row["VideoURL"] || "";
  document.getElementById("editDesc").value = row["Description"] || "";

  document.getElementById("editStatus").textContent = "Make changes and click Save.";
  document.getElementById("editOverlay").style.display = "flex";
}

function closeEdit() {
  document.getElementById("editOverlay").style.display = "none";
  currentEditSku = null;
}

async function saveEdit() {
  if (!currentEditSku) return;

  const statusEl = document.getElementById("editStatus");
  statusEl.textContent = "Saving‚Ä¶";

  const payload = {
    sku: currentEditSku,
    name: document.getElementById("editName").value.trim(),
    price: document.getElementById("editPrice").value.trim(),
    length: document.getElementById("editLength").value.trim(),
    width: document.getElementById("editWidth").value.trim(),
    height: document.getElementById("editHeight").value.trim(),
    weight: document.getElementById("editWeight").value.trim(),
    imageUrl1: document.getElementById("editImg1").value.trim(),
    imageUrl2: document.getElementById("editImg2").value.trim(),
    imageUrl3: document.getElementById("editImg3").value.trim(),
    videoUrl: document.getElementById("editVideo").value.trim(),
    description: document.getElementById("editDesc").value.trim()
  };

  try {
    const res = await fetch(SCRIPT_URL + "?action=updateProduct", {
      method: "POST",
      body: JSON.stringify(payload)
    });
    const data = await res.json();

    if (!data.success) {
      throw new Error(data.message || "Update failed");
    }

    // Update local array
    const idx = allProducts.findIndex(p => p["SKU"] === currentEditSku);
    if (idx > -1) {
      allProducts[idx]["Name"] = payload.name;
      allProducts[idx]["Price"] = payload.price;
      allProducts[idx]["Length"] = payload.length;
      allProducts[idx]["Width"] = payload.width;
      allProducts[idx]["Height"] = payload.height;
      allProducts[idx]["Weight"] = payload.weight;
      allProducts[idx]["Image URL 1"] = payload.imageUrl1;
      allProducts[idx]["Image URL 2"] = payload.imageUrl2;
      allProducts[idx]["Image URL 3"] = payload.imageUrl3;
      allProducts[idx]["Video URL"] = payload.videoUrl;
      allProducts[idx]["Description"] = payload.description;
    }

    statusEl.textContent = "Saved!";
    renderProducts();
    setTimeout(closeEdit, 600);
  } catch (err) {
    console.error(err);
    statusEl.textContent = "Error: " + err.message;
  }
}

/* ============================
   DELETE PRODUCT
============================ */
async function deleteProduct(row) {
  const sku = row["SKU"];
  if (!sku) return;

  const ok = confirm(`Delete product with SKU ${sku}?`);
  if (!ok) return;

  const statusEl = document.getElementById("statusText");
  statusEl.textContent = `Deleting ${sku}‚Ä¶`;

  try {
    const res = await fetch(SCRIPT_URL + "?action=deleteProduct", {
      method: "POST",
      body: JSON.stringify({ sku })
    });
    const data = await res.json();

    if (!data.success) {
      throw new Error(data.message || "Delete failed");
    }

    allProducts = allProducts.filter(p => p["SKU"] !== sku);
    renderProducts();
    statusEl.textContent = `Deleted ${sku}.`;
  } catch (err) {
    console.error(err);
    statusEl.textContent = "Error deleting product.";
  }
}

/* ============================
   INIT
============================ */
window.onload = function () {
  initAdminLogin();
  document.getElementById("searchInput").addEventListener("input", () => {
    renderProducts();
    const statusEl = document.getElementById("statusText");
    statusEl.textContent = `Showing ${filteredProducts().length} of ${allProducts.length} products.`;
  });
};
</script>

</body>
</html>

