<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Admin Dashboard ‚Ä¢ Gauri Creations</title>

<style>
  :root {
    --bg-grad: linear-gradient(135deg, #86e1ff, #ffd4b8);
    --glass-bg: rgba(255, 255, 255, 0.20);
    --glass-border: rgba(255, 255, 255, 0.55);
    --shadow-strong: 0 22px 60px rgba(15, 23, 42, 0.40);
    --accent-blue: #2563eb;
    --accent-pink: #ec4899;
    --accent-green: #22c55e;
    --accent-amber: #f59e0b;
    --danger-red: #ef4444;
  }

  * {
    box-sizing: border-box;
  }

  body {
    margin: 0;
    min-height: 100vh;
    font-family: system-ui, -apple-system, BlinkMacSystemFont, "Poppins", sans-serif;
    background: var(--bg-grad);
    display: flex;
    justify-content: center;
    align-items: stretch;
    padding: 18px;
    color: #0f172a;
  }

  .shell {
    width: 100%;
    max-width: 1200px;
    display: flex;
    flex-direction: column;
    gap: 14px;
  }

  /* ===========================
     LOGIN OVERLAY
     =========================== */
  #loginOverlay {
    position: fixed;
    inset: 0;
    background: radial-gradient(circle at top, #ffffffee, #000000cc);
    display: none;
    align-items: center;
    justify-content: center;
    z-index: 50;
  }

  .login-box {
    width: 92%;
    max-width: 340px;
    padding: 22px 20px 18px;
    background: rgba(15, 23, 42, 0.96);
    border-radius: 22px;
    color: #e5e7eb;
    box-shadow: 0 30px 70px rgba(0, 0, 0, 0.8);
    text-align: center;
  }

  .login-box h2 {
    margin: 0 0 6px;
    font-size: 20px;
  }

  .login-sub {
    font-size: 12px;
    color: #9ca3af;
    margin-bottom: 12px;
  }

  .login-input {
    width: 100%;
    margin-top: 8px;
    padding: 11px 13px;
    border-radius: 999px;
    border: 1px solid #4b5563;
    background: #020617;
    color: #e5e7eb;
    font-size: 14px;
    text-align: center;
  }

  .btn-login {
    margin-top: 12px;
    padding: 10px 18px;
    border-radius: 999px;
    border: none;
    background: linear-gradient(135deg, #22c55e, #a3e635);
    color: #022c22;
    font-weight: 600;
    font-size: 14px;
    cursor: pointer;
    width: 100%;
  }

  .login-error {
    font-size: 12px;
    color: #fecaca;
    margin-top: 6px;
    display: none;
  }

  /* ===========================
     TOPBAR
     =========================== */
  .topbar {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 10px 14px;
    border-radius: 22px;
    background: var(--glass-bg);
    border: 1px solid var(--glass-border);
    backdrop-filter: blur(18px);
    box-shadow: var(--shadow-strong);
  }

  .top-left {
    display: flex;
    align-items: center;
    gap: 10px;
  }

  .logo {
    width: 46px;
    height: 46px;
    border-radius: 16px;
    object-fit: cover;
    box-shadow: 0 10px 28px rgba(15, 23, 42, 0.45);
  }

  .title-main {
    font-size: 18px;
    font-weight: 700;
  }

  .subtitle {
    font-size: 12px;
    color: #4b5563;
  }

  .top-right {
    display: flex;
    gap: 8px;
    flex-wrap: wrap;
    justify-content: flex-end;
  }

  .pill-btn {
    border-radius: 999px;
    border: 1px solid rgba(148, 163, 184, 0.8);
    background: rgba(255,255,255,0.9);
    padding: 6px 13px;
    font-size: 12px;
    cursor: pointer;
    display: inline-flex;
    align-items: center;
    gap: 6px;
    text-decoration: none;
    color: #0f172a;
  }

  .pill-btn span.icon {
    font-size: 14px;
  }

  .pill-btn.primary {
    background: linear-gradient(135deg, #2563eb, #ec4899);
    color: white;
    border: none;
  }

  /* ===========================
     LAYOUT
     =========================== */
  #adminMain {
    display: none;
  }

  .main-layout {
    display: grid;
    grid-template-columns: minmax(0, 2fr) minmax(0, 1.5fr);
    gap: 12px;
  }

  @media (max-width: 900px) {
    .main-layout {
      grid-template-columns: minmax(0, 1fr);
    }
  }

  .card {
    border-radius: 22px;
    background: rgba(255,255,255,0.96);
    border: 1px solid rgba(148,163,184,0.6);
    box-shadow: var(--shadow-strong);
    padding: 14px;
  }

  .card-header {
    display: flex;
    justify-content: space-between;
    gap: 8px;
    align-items: baseline;
    margin-bottom: 6px;
  }

  .card-title {
    font-size: 15px;
    font-weight: 600;
  }

  .card-sub {
    font-size: 11px;
    color: #6b7280;
  }

  /* ===========================
     METRIC CARDS
     =========================== */
  .metrics-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
    gap: 10px;
    margin-top: 4px;
  }

  .metric {
    border-radius: 18px;
    padding: 10px 11px;
    background: linear-gradient(135deg, #ffffff, #e5f0ff);
    border: 1px solid rgba(226,232,240,0.9);
    display: flex;
    flex-direction: column;
    gap: 2px;
  }

  .metric-label {
    font-size: 11px;
    color: #6b7280;
  }

  .metric-value {
    font-size: 20px;
    font-weight: 700;
  }

  .metric-pill {
    align-self: flex-start;
    margin-top: 4px;
    padding: 3px 8px;
    border-radius: 999px;
    font-size: 11px;
  }

  .metric-pill.blue {
    background: rgba(37,99,235,0.1);
    color: #1d4ed8;
  }
  .metric-pill.green {
    background: rgba(34,197,94,0.1);
    color: #15803d;
  }
  .metric-pill.amber {
    background: rgba(245,158,11,0.12);
    color: #b45309;
  }
  .metric-pill.red {
    background: rgba(239,68,68,0.12);
    color: #b91c1c;
  }

  /* ===========================
     LATEST ORDERS TABLE
     =========================== */
  .orders-table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 6px;
    font-size: 12px;
  }

  .orders-table th,
  .orders-table td {
    padding: 6px 6px;
    text-align: left;
    border-bottom: 1px solid #e5e7eb;
  }

  .orders-table th {
    font-size: 11px;
    text-transform: uppercase;
    letter-spacing: 0.04em;
    color: #6b7280;
  }

  .badge {
    display: inline-flex;
    align-items: center;
    padding: 2px 8px;
    border-radius: 999px;
    font-size: 11px;
  }

  .badge.pending {
    background: rgba(251,191,36,0.15);
    color: #92400e;
  }

  .badge.paid {
    background: rgba(22,163,74,0.12);
    color: #166534;
  }

  .badge.shipped {
    background: rgba(37,99,235,0.12);
    color: #1d4ed8;
  }

  /* ===========================
     QUICK ACTIONS
     =========================== */
  .quick-actions {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
    gap: 10px;
    margin-top: 6px;
  }

  .qa-btn {
    border-radius: 18px;
    padding: 9px 10px;
    background: linear-gradient(135deg, #ffffff, #f5e9ff);
    border: 1px solid rgba(216,180,254,0.9);
    display: flex;
    flex-direction: column;
    gap: 3px;
    font-size: 12px;
    text-decoration: none;
    color: #111827;
    cursor: pointer;
  }

  .qa-label {
    font-weight: 600;
  }

  .qa-sub {
    font-size: 11px;
    color: #6b7280;
  }

  /* ===========================
     STATUS FOOTER
     =========================== */
  #statusBar {
    font-size: 11px;
    color: #6b7280;
    margin-top: 4px;
    text-align: right;
  }
</style>
</head>
<body>

<div id="loginOverlay">
  <div class="login-box">
    <h2>Admin Login</h2>
    <div class="login-sub">
      Enter your admin PIN to open the Gauri Creations dashboard.
    </div>
    <input id="adminPin" type="password" class="login-input" placeholder="Admin PIN" />
    <button id="loginBtn" class="btn-login">Unlock Dashboard</button>
    <div id="loginError" class="login-error">Incorrect PIN. Try again.</div>
  </div>
</div>

<div class="shell" id="adminMain">

  <!-- TOPBAR -->
  <header class="topbar">
    <div class="top-left">
      <img src="logo-gauri.jpeg" alt="Gauri Creations" class="logo" />
      <div>
        <div class="title-main">Admin Dashboard</div>
        <div class="subtitle">Overview of products, orders & performance.</div>
      </div>
    </div>
    <div class="top-right">
      <a href="store.html" class="pill-btn">
        <span class="icon">üõçÔ∏è</span> View Store
      </a>
      <a href="admin-add-product.html" class="pill-btn primary">
        <span class="icon">‚ûï</span> New Product
      </a>
      <button class="pill-btn" onclick="adminLogout()">
        <span class="icon">üîí</span> Logout
      </button>
    </div>
  </header>

  <!-- MAIN GRID -->
  <main class="main-layout">

    <!-- LEFT SIDE: METRICS + ORDERS -->
    <section class="card">
      <div class="card-header">
        <div>
          <div class="card-title">Snapshot</div>
          <div class="card-sub">Key metrics from Products & Orders sheets.</div>
        </div>
      </div>

      <div class="metrics-grid">
        <div class="metric">
          <div class="metric-label">Total Products</div>
          <div id="metricProducts" class="metric-value">‚Äì</div>
          <div class="metric-pill.blue">Live in catalog</div>
        </div>
        <div class="metric">
          <div class="metric-label">Low Stock (&lt;= 5)</div>
          <div id="metricLowStock" class="metric-value">‚Äì</div>
          <div class="metric-pill.amber">Need restock</div>
        </div>
        <div class="metric">
          <div class="metric-label">Total Orders</div>
          <div id="metricOrders" class="metric-value">‚Äì</div>
          <div class="metric-pill.green">All-time</div>
        </div>
        <div class="metric">
          <div class="metric-label">Pending Payments</div>
          <div id="metricPending" class="metric-value">‚Äì</div>
          <div class="metric-pill.red">Awaiting payment</div>
        </div>
      </div>

      <div style="margin-top: 10px;">
        <div class="card-header" style="margin-bottom:4px;">
          <div class="card-title">Latest Orders</div>
          <div class="card-sub">Last few orders from your Orders sheet.</div>
        </div>

        <table class="orders-table">
          <thead>
            <tr>
              <th>Order ID</th>
              <th>Product</th>
              <th>Total</th>
              <th>Status</th>
              <th>Payment</th>
            </tr>
          </thead>
          <tbody id="latestOrdersBody">
            <tr><td colspan="5">Loading‚Ä¶</td></tr>
          </tbody>
        </table>
      </div>
    </section>

    <!-- RIGHT SIDE: QUICK ACTIONS / PANELS -->
    <aside class="card">
      <div class="card-header">
        <div>
          <div class="card-title">Quick Actions</div>
          <div class="card-sub">Jump into common admin tools.</div>
        </div>
      </div>

      <div class="quick-actions">
        <a href="admin-add-product.html" class="qa-btn">
          <div class="qa-label">Add Product</div>
          <div class="qa-sub">Upload images, set price & stock.</div>
        </a>

        <a href="admin-manage-products.html" class="qa-btn">
          <div class="qa-label">Manage Products</div>
          <div class="qa-sub">Edit details, images & stock.</div>
        </a>

        <a href="admin-order.html" class="qa-btn">
          <div class="qa-label">Manage Orders</div>
          <div class="qa-sub">Update status, AWB & delivery.</div>
        </a>

        <a href="seller-hub.html" class="qa-btn">
          <div class="qa-label">Seller Hub</div>
          <div class="qa-sub">Labels, shipments & partners.</div>
        </a>

        <a href="track.html" class="qa-btn">
          <div class="qa-label">Track Panel</div>
          <div class="qa-sub">Test tracking view like a customer.</div>
        </a>

        <a href="#" class="qa-btn" onclick="alert('Coming soon: analytics & charts üìä')">
          <div class="qa-label">Analytics</div>
          <div class="qa-sub">Sales & performance charts.</div>
        </a>
      </div>

      <div id="statusBar">Loading dashboard data‚Ä¶</div>
    </aside>

  </main>

</div>

<script>
/* ==============================
   CONFIG
   ============================== */
const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbxC4stQOF3JfCFLrYVmudxE6ZVNWo7LxSVxbFejfIaDsDI016HReHbc2FEj4IELSir1uQ/exec"; // update if changed
const ADMIN_PIN = "1234";
const ADMIN_FLAG = "gc_admin_auth";

/* ==============================
   LOGIN HANDLING
   ============================== */
function initLogin() {
  const overlay = document.getElementById("loginOverlay");
  const main = document.getElementById("adminMain");
  const pinInput = document.getElementById("adminPin");
  const loginBtn = document.getElementById("loginBtn");
  const err = document.getElementById("loginError");

  function showDashboard() {
    overlay.style.display = "none";
    main.style.display = "flex";
    loadDashboard();
  }

  if (localStorage.getItem(ADMIN_FLAG) === "yes") {
    showDashboard();
  } else {
    overlay.style.display = "flex";
  }

  loginBtn.onclick = function () {
    if ((pinInput.value || "").trim() === ADMIN_PIN) {
      localStorage.setItem(ADMIN_FLAG, "yes");
      showDashboard();
    } else {
      err.style.display = "block";
    }
  };

  pinInput.addEventListener("keydown", (e) => {
    if (e.key === "Enter") loginBtn.click();
  });
}

function adminLogout() {
  localStorage.removeItem(ADMIN_FLAG);
  location.reload();
}

/* ==============================
   DASHBOARD DATA LOADING
   ============================== */
async function loadDashboard() {
  const statusBar = document.getElementById("statusBar");
  statusBar.textContent = "Loading products & orders‚Ä¶";

  try {
    const [productsRes, ordersRes] = await Promise.all([
      fetch(SCRIPT_URL + "?action=getProducts"),
      fetch(SCRIPT_URL + "?action=listOrders")
    ]);

    const productsData = await productsRes.json();
    const ordersData = await ordersRes.json();

    const products = productsData.products || [];
    const orders = ordersData.orders || [];

    updateMetrics(products, orders);
    renderLatestOrders(orders);

    statusBar.textContent = `Loaded ${products.length} products & ${orders.length} orders.`;
  } catch (err) {
    console.error(err);
    statusBar.textContent = "Error loading dashboard. Please refresh.";
  }
}

function updateMetrics(products, orders) {
  // Total products
  document.getElementById("metricProducts").textContent = products.length;

  // Low stock <= 5
  const lowStockCount = products.filter(p => {
    const stock = Number(p["Stock"] || 0);
    return stock > 0 && stock <= 5;
  }).length;
  document.getElementById("metricLowStock").textContent = lowStockCount;

  // Orders
  document.getElementById("metricOrders").textContent = orders.length;

  // Pending payments
  const pendingPayments = orders.filter(o => {
    const pay = (o["Payment Status"] || "").toString().toLowerCase();
    return pay === "pending" || pay === "unpaid" || pay === "";
  }).length;
  document.getElementById("metricPending").textContent = pendingPayments;
}

function renderLatestOrders(allOrders) {
  const tbody = document.getElementById("latestOrdersBody");
  tbody.innerHTML = "";

  if (!allOrders.length) {
    const tr = document.createElement("tr");
    const td = document.createElement("td");
    td.colSpan = 5;
    td.textContent = "No orders yet.";
    tbody.appendChild(tr);
    tr.appendChild(td);
    return;
  }

  // Sort by Timestamp descending if exists
  const orders = [...allOrders].sort((a, b) => {
    const t1 = new Date(a["Timestamp"] || 0).getTime();
    const t2 = new Date(b["Timestamp"] || 0).getTime();
    return t2 - t1;
  }).slice(0, 6); // latest 6

  orders.forEach(o => {
    const tr = document.createElement("tr");

    const tdId = document.createElement("td");
    tdId.textContent = o["Order ID"] || "-";

    const tdProd = document.createElement("td");
    tdProd.textContent = o["Product Name"] || "-";

    const tdTotal = document.createElement("td");
    tdTotal.textContent = "‚Çπ" + (o["Total"] || "0");

    const tdStatus = document.createElement("td");
    const sBadge = document.createElement("span");
    sBadge.className = "badge";
    const statusText = (o["Status"] || "Order Received").toString();
    sBadge.textContent = statusText;

    if (/delivered/i.test(statusText)) sBadge.classList.add("paid");
    else if (/shipped|dispatched/i.test(statusText)) sBadge.classList.add("shipped");
    else sBadge.classList.add("pending");
    tdStatus.appendChild(sBadge);

    const tdPay = document.createElement("td");
    const pBadge = document.createElement("span");
    pBadge.className = "badge";
    const payText = (o["Payment Status"] || "Pending").toString();
    pBadge.textContent = payText;
    if (/paid/i.test(payText)) pBadge.classList.add("paid");
    else pBadge.classList.add("pending");
    tdPay.appendChild(pBadge);

    tr.appendChild(tdId);
    tr.appendChild(tdProd);
    tr.appendChild(tdTotal);
    tr.appendChild(tdStatus);
    tr.appendChild(tdPay);

    tbody.appendChild(tr);
  });
}

/* ==============================
   INIT
   ============================== */
window.onload = initLogin;
</script>

</body>
</html>
