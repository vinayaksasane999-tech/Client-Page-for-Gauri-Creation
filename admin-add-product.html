<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Add Product ‚Ä¢ Gauri Creations</title>
<!-- Favicon -->
<link rel="icon" href="favicon.ico" type="image/x-icon">
<link rel="apple-touch-icon" href="favicon.ico">
  
<style>
  :root {
    --bg-grad: linear-gradient(135deg, #86e1ff, #ffd4b8);
    --glass-bg: rgba(255, 255, 255, 0.18);
    --glass-border: rgba(255, 255, 255, 0.6);
    --shadow-strong: 0 22px 60px rgba(15, 23, 42, 0.40);
  }

  *{ box-sizing:border-box; }

  body {
    margin:0;
    min-height:100vh;
    font-family:Poppins, system-ui;
    background:var(--bg-grad);
    display:flex;
    justify-content:center;
    padding:18px;
  }

  .shell { width:100%; max-width:980px; }

  .card {
    border-radius:26px;
    background:var(--glass-bg);
    border:1px solid var(--glass-border);
    backdrop-filter:blur(22px);
    padding:18px;
    box-shadow:var(--shadow-strong);
  }

  .card-header {
    display:flex;
    justify-content:space-between;
    margin-bottom:16px;
  }

  .card-title { font-size:20px; font-weight:700; }
  .card-sub { font-size:12px; color:#555; }

  .pill-link {
    border:1px solid #ccc;
    background:white;
    padding:7px 12px;
    border-radius:999px;
    text-decoration:none;
    font-size:12px;
    color:#111;
  }

  .layout {
    display:grid;
    grid-template-columns:1.3fr 1fr;
    gap:14px;
  }

  @media(max-width:900px){
    .layout{ grid-template-columns:1fr; }
  }

  .section-card {
    background:white;
    border-radius:20px;
    padding:14px;
    border:1px solid #e5e7eb;
    box-shadow:0 10px 25px rgba(0,0,0,0.15);
  }

  .section-title { font-size:14px; font-weight:600; margin-bottom:4px; }
  .section-sub { font-size:11px; color:#777; margin-bottom:10px; }

  label { font-size:12px; font-weight:600; margin-bottom:4px; display:block; }

  .input, .textarea{
    width:100%;
    padding:9px 12px;
    border-radius:12px;
    border:1px solid #ccc;
    background:#f5f5f5;
    font-size:13px;
  }

  .textarea{ resize:vertical; min-height:80px; }

  .field-row {
    display:grid;
    grid-template-columns:1fr 1fr;
    gap:10px;
  }

  @media(max-width:600px){
    .field-row{ grid-template-columns:1fr; }
  }

  /* Dropzone styles */
  .drop-zone {
    border:1.5px dashed #999;
    padding:14px;
    border-radius:16px;
    background:#fafafa;
    text-align:center;
    cursor:pointer;
    font-size:12px;
  }

  .drop-zone.hover {
    background:#e7f0ff;
    border-color:#2563eb;
  }

  .preview-grid {
    margin-top:10px;
    display:grid;
    grid-template-columns:repeat(3, 1fr);
    gap:8px;
  }

  .preview-card {
    position:relative;
    height:90px;
    border-radius:14px;
    overflow:hidden;
    background:#ddd;
  }

  .preview-card img{
    width:100%;
    height:100%;
    object-fit:cover;
  }

  .remove-btn{
    position:absolute;
    top:4px; right:4px;
    background:#e11d48;
    color:white;
    border:none;
    border-radius:999px;
    padding:3px 7px;
    font-size:10px;
    cursor:pointer;
  }

  .preview-label{
    position:absolute;
    bottom:4px; left:4px;
    background:#0009;
    color:white;
    font-size:10px;
    padding:2px 6px;
    border-radius:999px;
  }

  .video-chip{
    margin-top:8px;
    background:#def7ec;
    padding:6px 10px;
    border-radius:10px;
    font-size:11px;
    display:inline-flex;
    gap:6px;
  }

  .footer-row{
    margin-top:16px;
    display:flex;
    justify-content:space-between;
    align-items:center;
  }

  .btn-primary{
    background:linear-gradient(135deg,#2563eb,#ec4899);
    color:white;
    border:none;
    padding:12px 20px;
    border-radius:999px;
    font-size:14px;
    display:flex;
    align-items:center;
    gap:6px;
    cursor:pointer;
  }

  .status-text{ font-size:12px; color:#777; }
  .status-text.ok{ color:#15803d; }
  .status-text.err{ color:#e11d48; }
</style>

</head>
<body>

<div class="shell">
<div class="card">

  <div class="card-header">
    <div>
      <div class="card-title">Add New Product</div>
      <div class="card-sub">Upload images & details. Backend auto-converts Google Drive links.</div>
    </div>
    <a href="admin.html" class="pill-link">‚Üê Back</a>
  </div>

  <div class="layout">

    <!-- LEFT SIDE -->
    <section class="section-card">
      <div class="section-title">Basic Details</div>
      <div class="section-sub">Shown everywhere in store & product page.</div>

      <label>Product Name *</label>
      <input id="name" class="input" type="text"/>

      <div class="field-row">
        <div>
          <label>Price (‚Çπ) *</label>
          <input id="price" class="input" type="number"/>
        </div>
        <div>
          <label>Category *</label>
          <input id="category" class="input" type="text"/>
        </div>
      </div>

      <div class="field-row">
        <div>
          <label>Stock *</label>
          <input id="stock" class="input" type="number"/>
        </div>
        <div>
          <label>Weight</label>
          <input id="weight" class="input" type="text"/>
        </div>
      </div>

      <div class="field-row">
        <div>
          <label>Length</label>
          <input id="length" class="input" type="number"/>
        </div>
        <div>
          <label>Width</label>
          <input id="width" class="input" type="number"/>
        </div>
      </div>

      <div class="field-row">
        <div>
          <label>Height</label>
          <input id="height" class="input" type="number"/>
        </div>
        <div>
          <label>Video URL (optional)</label>
          <input id="videoUrlInput" class="input" type="text" placeholder="Google Drive / YouTube link"/>
        </div>
      </div>

      <label>Description</label>
      <textarea id="description" class="textarea"></textarea>

    </section>

    <!-- RIGHT SIDE (MEDIA) -->
    <section class="section-card">
      <div class="section-title">Media Upload</div>
      <div class="section-sub">Backend will auto-convert Google Drive URLs ‚Üí working image links.</div>

      <label>Product Images (max 5)</label>
      <div id="imageDropZone" class="drop-zone">Click or drag images here</div>
      <input id="imageInput" type="file" accept="image/*" multiple style="display:none;">
      <div id="imagePreview" class="preview-grid"></div>

      <br/>
      <label>Product Video (optional)</label>
      <div id="videoDropZone" class="drop-zone">Click or drag video here</div>
      <input id="videoInput" type="file" accept="video/*" style="display:none;">
      <div id="videoInfo" class="video-chip" style="display:none;">
        üé¨ <span id="videoName"></span>
      </div>

    </section>

  </div>

  <div class="footer-row">
    <div id="statusText" class="status-text">Fill details and click Add Product.</div>
    <button id="saveBtn" class="btn-primary">‚ûï Add Product</button>
  </div>

</div>
</div>
<script>
const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbx6E_RYQxhsfI8jSzLJr1AOcpv7XCMF-KqmJBqbqUWrvXGTxKA5uGixiZrnhQgZ6W83/exec";

let imageFiles = [];
let videoFile = null;

// Helper to get element
const qs = (id) => document.getElementById(id);

// DOM Elements
const imageDropZone = qs("imageDropZone");
const imageInput = qs("imageInput");
const imagePreview = qs("imagePreview");

const videoDropZone = qs("videoDropZone");
const videoInput = qs("videoInput");
const videoInfo = qs("videoInfo");
const videoNameEl = qs("videoName");

const statusText = qs("statusText");
const saveBtn = qs("saveBtn");

/* ------------------------------
   IMAGE DRAG/DROP HANDLERS
------------------------------ */
imageDropZone.addEventListener("click", () => imageInput.click());

imageDropZone.addEventListener("dragover", (e) => {
  e.preventDefault();
  imageDropZone.classList.add("hover");
});
imageDropZone.addEventListener("dragleave", () => {
  imageDropZone.classList.remove("hover");
});
imageDropZone.addEventListener("drop", (e) => {
  e.preventDefault();
  imageDropZone.classList.remove("hover");
  handleImageFiles(e.dataTransfer.files);
});

imageInput.addEventListener("change", (e) => handleImageFiles(e.target.files));

function handleImageFiles(fileList) {
  const files = Array.from(fileList).filter(f => f.type.startsWith("image/"));
  const slotsLeft = 5 - imageFiles.length;
  const toAdd = files.slice(0, slotsLeft);

  imageFiles = imageFiles.concat(toAdd);
  renderImagePreview();

  if (files.length > slotsLeft) {
    alert("Maximum 5 images allowed. Extra images ignored.");
  }
}

function renderImagePreview() {
  imagePreview.innerHTML = "";
  imageFiles.forEach((file, i) => {
    const card = document.createElement("div");
    card.className = "preview-card";

    const reader = new FileReader();
    reader.onload = () => {
      card.innerHTML = `
        <img src="${reader.result}">
        <div class="preview-label">Img ${i + 1}</div>
        <button class="remove-btn" onclick="removeImage(${i})">‚úï</button>
      `;
    };
    reader.readAsDataURL(file);

    imagePreview.appendChild(card);
  });
}

window.removeImage = function(index) {
  imageFiles.splice(index, 1);
  renderImagePreview();
};

/* ------------------------------
   VIDEO DRAG/DROP HANDLERS
------------------------------ */
videoDropZone.addEventListener("click", () => videoInput.click());

videoDropZone.addEventListener("dragover", (e) => {
  e.preventDefault();
  videoDropZone.classList.add("hover");
});
videoDropZone.addEventListener("dragleave", () => {
  videoDropZone.classList.remove("hover");
});
videoDropZone.addEventListener("drop", (e) => {
  e.preventDefault();
  videoDropZone.classList.remove("hover");

  const files = Array.from(e.dataTransfer.files).filter(f => f.type.startsWith("video/"));
  if (files.length) {
    videoFile = files[0];
    videoNameEl.textContent = videoFile.name;
    videoInfo.style.display = "inline-flex";
  }
});

videoInput.addEventListener("change", (e) => {
  const f = e.target.files[0];
  if (f && f.type.startsWith("video/")) {
    videoFile = f;
    videoNameEl.textContent = videoFile.name;
    videoInfo.style.display = "inline-flex";
  }
});

/* ------------------------------
   UPLOAD FILE TO DRIVE
------------------------------ */
async function uploadFileToDrive(file) {
  return new Promise((resolve, reject) => {
    const reader = new FileReader();
    reader.onload = async () => {
      try {
        const base64 = reader.result;

        const res = await fetch(SCRIPT_URL + "?action=uploadMedia", {
          method: "POST",
          body: JSON.stringify({
            base64,
            fileName: file.name,
            mimeType: file.type
          })
        });

        const data = await res.json();
        if (data.success && data.url) {
          resolve(data.url); // backend will auto-convert to googleusercontent
        } else {
          reject("Upload failed");
        }

      } catch (err) {
        reject(err);
      }
    };

    reader.readAsDataURL(file);
  });
}

/* ------------------------------
   SUBMIT PRODUCT
------------------------------ */
saveBtn.addEventListener("click", submitProduct);

async function submitProduct() {
  const name = qs("name").value.trim();
  const price = qs("price").value.trim();
  const category = qs("category").value.trim();
  const stock = qs("stock").value.trim();
  const weight = qs("weight").value.trim();
  const length = qs("length").value.trim();
  const width = qs("width").value.trim();
  const height = qs("height").value.trim();
  const description = qs("description").value.trim();

  const videoUrlField = qs("videoUrlInput").value.trim();

  if (!name || !price || !category || !stock) {
    statusText.textContent = "Please fill Product Name, Price, Category, and Stock.";
    statusText.className = "status-text err";
    return;
  }

  saveBtn.disabled = true;
  saveBtn.innerHTML = "‚è≥ Saving‚Ä¶";

  statusText.textContent = "Uploading media to Drive‚Ä¶";

  let imageUrls = ["","","","",""];
  let videoUrl = "";

  try {
    // Upload IMAGES
    for (let i = 0; i < imageFiles.length; i++) {
      const uploadedURL = await uploadFileToDrive(imageFiles[i]);
      imageUrls[i] = uploadedURL;
      statusText.textContent = `Uploading images‚Ä¶ (${i + 1}/${imageFiles.length})`;
    }

    // Upload VIDEO or use link
    if (videoFile) {
      videoUrl = await uploadFileToDrive(videoFile);
    } else if (videoUrlField) {
      videoUrl = videoUrlField; // backend will convert if Drive link
    }

    statusText.textContent = "Saving product details‚Ä¶";

    // BODY sent to backend
    const body = {
      name,
      price,
      category,
      stock,
      weight,
      length,
      width,
      height,
      description,
      videoUrl,
      imageUrl1: imageUrls[0],
      imageUrl2: imageUrls[1],
      imageUrl3: imageUrls[2],
      imageUrl4: imageUrls[3],
      imageUrl5: imageUrls[4]
    };

    const res = await fetch(SCRIPT_URL + "?action=createProduct", {
      method: "POST",
      body: JSON.stringify(body)
    });

    const data = await res.json();

    if (!data.success) {
      throw new Error(data.message || "Could not create product");
    }

    statusText.textContent = "Product Saved ‚úî";
    statusText.className = "status-text ok";
    saveBtn.innerHTML = "‚úî Saved";

    // Reset form after short delay
    setTimeout(() => {
      saveBtn.disabled = false;
      saveBtn.innerHTML = "‚ûï Add Another Product";
      statusText.textContent = "You can add another product now.";
    }, 1500);

  } catch (err) {
    console.error(err);
    statusText.textContent = "Error: " + err;
    statusText.className = "status-text err";
    saveBtn.disabled = false;
    saveBtn.innerHTML = "‚ûï Add Product";
  }
}
</script>

</body>
</html>
