<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Add Product â€¢ Gauri Creations</title>

<style>
  body {
    font-family: "Poppins", sans-serif;
    background: #f7f7fb;
    margin: 0;
    padding: 20px;
  }

  .container {
    max-width: 700px;
    margin: auto;
    background: white;
    padding: 22px;
    border-radius: 18px;
    box-shadow: 0 8px 30px rgba(0,0,0,0.12);
  }

  h2 {
    margin-top: 0;
    text-align: center;
  }

  label {
    font-weight: 600;
    margin-top: 10px;
    display: block;
  }

  input, textarea, select {
    width: 100%;
    padding: 10px;
    margin-top: 6px;
    border-radius: 10px;
    border: 1px solid #ccc;
    font-size: 14px;
  }

  .images-grid {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 10px;
    margin-top: 10px;
  }

  .img-box {
    width: 100%;
    height: 110px;
    border-radius: 12px;
    background: #f1f1f1;
    display: flex;
    justify-content: center;
    align-items: center;
    font-size: 12px;
    color: #666;
    overflow: hidden;
  }

  .img-box img {
    width: 100%;
    height: 100%;
    object-fit: cover;
  }

  button {
    width: 100%;
    padding: 12px;
    margin-top: 18px;
    background: #2563eb;
    border: none;
    border-radius: 12px;
    color: white;
    font-size: 15px;
    cursor: pointer;
  }

  button:disabled {
    opacity: 0.5;
  }

  .success-box {
    display: none;
    background: #22c55e;
    padding: 12px;
    text-align: center;
    color: white;
    border-radius: 12px;
    margin-top: 15px;
  }
</style>
</head>

<body>

<div class="container">
  <h2>Add New Product</h2>

  <label>Product Name</label>
  <input id="name" type="text" placeholder="Decorative Supari" />

  <label>Price (â‚¹)</label>
  <input id="price" type="number" />

  <label>Category</label>
  <input id="category" type="text" placeholder="Supari" />

  <label>Stock</label>
  <input id="stock" type="number" />

  <label>Length</label>
  <input id="length" type="number" />

  <label>Width</label>
  <input id="width" type="number" />

  <label>Height</label>
  <input id="height" type="number" />

  <label>Weight</label>
  <input id="weight" type="text" placeholder="50g" />

  <label>Description</label>
  <textarea id="description" rows="3"></textarea>

  <label>YouTube / Video URL</label>
  <input id="video" type="text" placeholder="https://youtu.be/xxxxxx" />

  <label>Upload Images (Up to 5)</label>
  <input id="imagesInput" type="file" accept="image/*" multiple />

  <div class="images-grid" id="previewGrid"></div>

  <button id="saveBtn" onclick="submitProduct()">Save Product</button>

  <div class="success-box" id="successBox">Product Added Successfully ðŸŽ‰</div>
</div>


<script>
const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbxC4stQOF3JfCFLrYVmudxE6ZVNWo7LxSVxbFejfIaDsDI016HReHbc2FEj4IELSir1uQ/exec";

let uploadedImages = [];

// --------------------------------------------
// Preview Images
// --------------------------------------------
document.getElementById("imagesInput").addEventListener("change", function(e){
  const files = e.target.files;
  const preview = document.getElementById("previewGrid");
  preview.innerHTML = "";

  [...files].forEach(file => {
    const reader = new FileReader();
    reader.onload = () => {
      const div = document.createElement("div");
      div.className = "img-box";
      div.innerHTML = `<img src="${reader.result}">`;
      preview.appendChild(div);
    };
    reader.readAsDataURL(file);
  });
});


// --------------------------------------------
// Upload Single Image â†’ Google Drive
// --------------------------------------------
async function uploadImage(file){
  return new Promise((resolve, reject) => {
    const reader = new FileReader();
    reader.onload = async () => {
      const base64 = reader.result;

      const res = await fetch(SCRIPT_URL + "?action=uploadMedia", {
        method: "POST",
        body: JSON.stringify({
          base64: base64,
          fileName: file.name,
          mimeType: file.type
        })
      });

      const data = await res.json();
      if(data.success) resolve(data.url);
      else reject("Upload failed");
    };
    reader.readAsDataURL(file);
  });
}


// --------------------------------------------
// Submit Product (Uploads Images â†’ Save Product)
// --------------------------------------------
async function submitProduct(){
  const btn = document.getElementById("saveBtn");
  btn.disabled = true;
  btn.textContent = "Savingâ€¦";

  const files = document.getElementById("imagesInput").files;

  // Upload images first
  uploadedImages = [];
  for(let f of files){
    const url = await uploadImage(f);
    uploadedImages.push(url);
  }

  // Pad empty images so backend gets complete 5 fields
  while(uploadedImages.length < 5) uploadedImages.push("");

  // Prepare body
  const body = {
    name: document.getElementById("name").value,
    price: document.getElementById("price").value,
    category: document.getElementById("category").value,
    stock: document.getElementById("stock").value,
    length: document.getElementById("length").value,
    width: document.getElementById("width").value,
    height: document.getElementById("height").value,
    weight: document.getElementById("weight").value,
    description: document.getElementById("description").value,
    videoUrl: document.getElementById("video").value,

    imageUrl1: uploadedImages[0],
    imageUrl2: uploadedImages[1],
    imageUrl3: uploadedImages[2],
    imageUrl4: uploadedImages[3],
    imageUrl5: uploadedImages[4]
  };

  // Send to backend
  const res = await fetch(SCRIPT_URL + "?action=createProduct", {
    method: "POST",
    body: JSON.stringify(body)
  });

  const result = await res.json();

  if(result.success){
    document.getElementById("successBox").style.display = "block";
    btn.textContent = "Saved âœ”";

    setTimeout(() => {
      window.location.href = "admin-dashboard.html";
    }, 1500);
  } else {
    alert("Error: " + result.message);
    btn.disabled = false;
    btn.textContent = "Save Product";
  }
}
</script>

</body>
</html>


