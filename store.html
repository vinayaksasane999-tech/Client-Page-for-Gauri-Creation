<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Gauri Creations â€¢ Store</title>
<style>
  :root{
    --bg-grad: linear-gradient(135deg,#e3f2ff,#ffe5f3);
    --glass: rgba(255,255,255,0.78);
    --glass-strong: rgba(255,255,255,0.92);
    --glass-border: rgba(148,163,184,0.6);
    --shadow-strong: 0 20px 45px rgba(15,23,42,0.30);
    --accent-grad: linear-gradient(135deg,#2563eb,#ec4899);
    --muted:#6b7280;
  }
  *{box-sizing:border-box}
  body{
    margin:0;min-height:100vh;font-family:system-ui,-apple-system,BlinkMacSystemFont,'Poppins',sans-serif;
    background:var(--bg-grad);padding:18px 14px 28px;display:flex;justify-content:center;
  }
  .shell{width:100%;max-width:1150px}

  /* HERO */
  .hero{display:grid;grid-template-columns:3fr 2.2fr;gap:12px;margin-bottom:14px}
  @media(max-width:820px){ .hero{grid-template-columns:1fr} }

  .hero-main{
    background:linear-gradient(135deg,rgba(255,255,255,0.96),rgba(239,246,255,0.98));
    border-radius:22px;padding:16px;border:1px solid var(--glass-border);box-shadow:var(--shadow-strong);
  }
  .hero-title{font-size:24px;font-weight:800}
  .hero-sub{font-size:13px;color:var(--muted)}
  .hero-tags{margin-top:6px;display:flex;gap:6px;flex-wrap:wrap}
  .tag-pill{padding:4px 10px;border-radius:999px;font-size:11px;border:1px solid rgba(209,213,219,0.9);background:rgba(255,255,255,0.9)}

  .hero-side{
    border-radius:22px;padding:14px;background:radial-gradient(circle at top left,rgba(255,255,255,0.98),rgba(219,234,254,0.98));
    border:1px solid var(--glass-border);box-shadow:var(--shadow-strong);
  }

  /* FILTERS */
  .filters{background:var(--glass);border-radius:20px;padding:12px;border:1px solid var(--glass-border);backdrop-filter:blur(18px);box-shadow:var(--shadow-strong);margin-bottom:14px}
  .filters-top{display:flex;gap:10px;align-items:center}
  #searchInput{flex:1 1 180px;padding:9px 11px;border-radius:999px;border:1px solid #d1d5db;font-size:13px}
  .filters-row{display:grid;grid-template-columns:repeat(3,minmax(0,1fr));gap:8px}
  @media(max-width:720px){ .filters-row{grid-template-columns:repeat(2,minmax(0,1fr))} }
  @media(max-width:480px){ .filters-row{grid-template-columns:1fr} }

  /* GRID */
  .grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(170px,1fr));gap:14px}

  /* PRODUCT CARD */
  .product-card{
    border-radius:16px;background:var(--glass-strong);border:1px solid rgba(209,213,219,0.7);
    box-shadow:0 10px 30px rgba(15,23,42,0.12);padding:10px;display:flex;flex-direction:column;gap:8px;
    transition:transform .16s ease,box-shadow .16s ease;
  }
  .product-card:hover{ transform:translateY(-6px); box-shadow:0 20px 50px rgba(15,23,42,0.18);}

  .product-img-wrap{border-radius:12px;overflow:hidden;position:relative;background:linear-gradient(180deg,#fff,#f8fafc);height:140px;display:flex;align-items:center;justify-content:center}
  .product-img{width:100%;height:100%;object-fit:cover;display:block;transition:transform .35s ease}
  .product-card:hover .product-img{ transform:scale(1.03); }

  .stock-badge{position:absolute;left:8px;top:8px;padding:4px 8px;border-radius:999px;font-size:11px;background:rgba(22,163,74,0.93);color:#fff}
  .stock-badge.out{background:rgba(239,68,68,0.96)}

  .wishlist-heart{position:absolute;right:8px;top:8px;width:28px;height:28px;border-radius:999px;background:rgba(255,255,255,0.92);display:flex;align-items:center;justify-content:center;font-size:15px;cursor:pointer;border:1px solid rgba(209,213,219,0.9)}
  .wishlist-heart.active{color:#fb7185}

  .product-name{font-size:14px;font-weight:600}
  .product-price{font-size:16px;font-weight:800;color:#e11d48}
  .rating-line{font-size:11px;color:var(--muted);display:flex;align-items:center;gap:6px}
  .product-actions{display:flex;gap:8px;margin-top:6px;align-items:center}
  .btn{border-radius:999px;border:none;padding:6px 10px;font-size:12px;cursor:pointer;font-weight:600;line-height:1.1}
  .btn-outline{background:white;border:1px solid #d1d5db;color:#111827}
  .btn-primary{background:var(--accent-grad);color:#fff}

  .empty-state{text-align:center;color:var(--muted);margin-top:20px;font-size:13px}

  /* smaller thumbnail used in admin (example guidance) */
  .thumb-small{width:46px;height:46px;border-radius:12px;object-fit:cover}
</style>
</head>
<body>
<div class="shell">

  <section class="hero">
    <div class="hero-main">
      <img src="logo-gauri.jpeg" alt="Gauri" style="width:120px;border-radius:10px;margin-bottom:10px;display:block">
      <div class="hero-title">Gauri Creations Store</div>
      <div class="hero-sub">Discover exclusive handcrafted designs, premium wedding decor and elegant creations â€“ curated and shipped with love.</div>
      <div class="hero-tags">
        <span class="tag-pill">âœ¨ Handpicked Designs</span>
        <span class="tag-pill">ðŸšš Pan India Shipping</span>
        <span class="tag-pill">ðŸ’³ Secure Offline / UPI Payment</span>
      </div>
      <div style="margin-top:10px;font-size:12px;color:var(--muted)">Live catalog from Google Sheets â€¢ Admin-controlled inventory</div>
      <div id="heroBanners" style="margin-top:12px;display:flex;gap:8px;overflow:auto"></div>
    </div>

    <aside class="hero-side">
      <div style="font-weight:600;margin-bottom:8px">Store Snapshot</div>
      <div style="display:flex;justify-content:space-between;color:var(--muted);margin-bottom:6px"><span>Total products</span><span id="summaryTotal">â€“</span></div>
      <div style="display:flex;justify-content:space-between;color:var(--muted);margin-bottom:6px"><span>In-stock styles</span><span id="summaryInStock">â€“</span></div>
      <div style="display:flex;justify-content:space-between;color:var(--muted);margin-bottom:6px"><span>Low stock (â‰¤ 5)</span><span id="summaryLowStock">â€“</span></div>
      <div style="display:flex;justify-content:space-between;color:var(--muted);margin-bottom:10px"><span>Average rating</span><span id="summaryRating">â€“</span></div>
      <div id="summaryBadge" style="font-size:12px;padding:8px;background:rgba(255,255,255,0.95);border-radius:10px">Loading live catalogâ€¦</div>
    </aside>
  </section>

  <section class="filters">
    <div class="filters-top">
      <input id="searchInput" type="text" placeholder="Search products by name, SKU or categoryâ€¦" />
    </div>

    <div class="filters-row" style="margin-top:10px">
      <select id="categoryFilter"><option value="">All Categories</option></select>
      <select id="sortFilter">
        <option value="">Sort by</option>
        <option value="priceLow">Price: Low â†’ High</option>
        <option value="priceHigh">Price: High â†’ Low</option>
        <option value="ratingHigh">Rating: High â†’ Low</option>
        <option value="newest">Newest First</option>
      </select>
      <select id="stockFilter">
        <option value="">Stock: All</option>
        <option value="in">In Stock only</option>
        <option value="low">Low Stock (â‰¤ 5)</option>
        <option value="out">Out of Stock</option>
      </select>
    </div>

    <div style="display:flex;gap:8px;margin-top:10px;flex-wrap:wrap">
      <input id="minPrice" type="number" placeholder="Min price (â‚¹)" style="padding:8px;border-radius:10px;border:1px solid #d1d5db">
      <input id="maxPrice" type="number" placeholder="Max price (â‚¹)" style="padding:8px;border-radius:10px;border:1px solid #d1d5db">
      <div style="flex:1"></div>
    </div>

    <div style="display:flex;justify-content:space-between;margin-top:10px;font-size:12px;color:var(--muted)">
      <span id="filtersInfo">Loading productsâ€¦</span>
      <span id="filtersCount"></span>
    </div>
  </section>

  <section id="grid" class="grid"></section>
  <div id="emptyState" class="empty-state" style="display:none">No products match your filters.</div>
</div>

<script>
/* SINGLE fixImage utility (unified) */
function fixImage(url){
  if(!url) return "";
  url = String(url).trim();
  if(url.includes("googleusercontent.com")) return url;
  // try to grab drive file id
  const m = url.match(/[-\w]{25,}/);
  if(m) return `https://lh3.googleusercontent.com/d/${m[0]}=w1000`;
  return url;
}

const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbwxlp4ehND6OHfGY9ruPptTs4euh3U-v3y6IA90EfmwjuiFZD4BnoHDjifKAPG9B1T7/exec";
let ALL_PRODUCTS = [], FILTERED = [];

function toNumber(v){ const n = Number(v); return isNaN(n)?0:n; }

/* Load (only once) */
async function loadProducts(){
  const info = document.getElementById("filtersInfo");
  info.textContent = "Loading products from serverâ€¦";
  try {
    const res = await fetch(SCRIPT_URL + "?action=getProducts");
    const data = await res.json();
    if(!data.success) throw new Error(data.message || "Load failed");
    ALL_PRODUCTS = data.products || [];
    populateCategories();
    updateSummary();
    applyFilters();
    info.textContent = "Catalog loaded successfully.";
  } catch(err){
    console.error(err);
    ALL_PRODUCTS = [];
    applyFilters();
    info.textContent = "Error loading products. Please refresh.";
  }
}

function populateCategories(){
  const select = document.getElementById("categoryFilter");
  select.innerHTML = '<option value="">All Categories</option>';
  const cats = new Set();
  ALL_PRODUCTS.forEach(p => { const c = (p["Category"]||"").toString().trim(); if(c) cats.add(c); });
  Array.from(cats).sort().forEach(cat => {
    const o = document.createElement("option"); o.value = cat; o.textContent = cat; select.appendChild(o);
  });
}

function updateSummary(){
  const total = ALL_PRODUCTS.length;
  const inStock = ALL_PRODUCTS.filter(p=>toNumber(p["Stock"])>0).length;
  const lowStock = ALL_PRODUCTS.filter(p=>{const s = toNumber(p["Stock"]);return s>0 && s<=5;}).length;
  const rated = ALL_PRODUCTS.filter(p=>toNumber(p["Rating"])>0);
  let avgRating = "â€“";
  if(rated.length){ const sum = rated.reduce((a,p)=>a+toNumber(p["Rating"]),0); avgRating = (sum/rated.length).toFixed(1); }
  document.getElementById("summaryTotal").textContent = total;
  document.getElementById("summaryInStock").textContent = inStock;
  document.getElementById("summaryLowStock").textContent = lowStock;
  document.getElementById("summaryRating").textContent = avgRating;
  const badge = document.getElementById("summaryBadge");
  badge.textContent = !total ? "No products added yet." : (lowStock>0 ? `${lowStock} items running low â€“ restock recommended.` : "Inventory looks healthy ðŸ’š");
  renderHeroBanners();
}

function renderHeroBanners(){
  const c = document.getElementById("heroBanners");
  c.innerHTML = "";
  if(!ALL_PRODUCTS.length){ const chip=document.createElement("div"); chip.className="tag-pill"; chip.textContent="No products yet"; c.appendChild(chip); return; }
  const sorted = [...ALL_PRODUCTS].sort((a,b)=>toNumber(b["Rating"]) - toNumber(a["Rating"]));
  sorted.slice(0,3).forEach(p=>{
    const chip = document.createElement("div");
    chip.style.cssText = "min-width:160px;padding:8px 10px;border-radius:12px;background:#fff;border:1px solid rgba(0,0,0,0.04);font-size:12px;margin-right:8px";
    chip.innerHTML = `<strong style="display:block">${p["Name"]||"Product"}</strong><span style="font-size:12px;color:${'var(--muted)'}">${toNumber(p["Price"]) ? 'â‚¹'+p["Price"] : ''} â€¢ ${p["Rating"]? 'â˜… '+p["Rating"] : 'New'}</span>`;
    c.appendChild(chip);
  });
}

/* Filters */
function applyFilters(){
  const q = (document.getElementById("searchInput").value || "").toLowerCase().trim();
  const cat = document.getElementById("categoryFilter").value;
  const sort = document.getElementById("sortFilter").value;
  const stockMode = document.getElementById("stockFilter").value;
  const minP = toNumber(document.getElementById("minPrice").value);
  const maxP = toNumber(document.getElementById("maxPrice").value);

  let list = [...ALL_PRODUCTS];
  if(q) list = list.filter(p => ((p["Name"]||"")+" "+(p["SKU"]||"")+" "+(p["Category"]||"")).toLowerCase().includes(q));
  if(cat) list = list.filter(p => (p["Category"]||"") === cat);
  list = list.filter(p => {
    const s = toNumber(p["Stock"]);
    if(stockMode==="in") return s>0;
    if(stockMode==="low") return s>0 && s<=5;
    if(stockMode==="out") return s<=0;
    return true;
  });
  if(minP) list = list.filter(p => toNumber(p["Price"]) >= minP);
  if(maxP) list = list.filter(p => toNumber(p["Price"]) <= maxP);

  if(sort==="priceLow") list.sort((a,b)=>toNumber(a["Price"]) - toNumber(b["Price"]));
  else if(sort==="priceHigh") list.sort((a,b)=>toNumber(b["Price"]) - toNumber(a["Price"]));
  else if(sort==="ratingHigh") list.sort((a,b)=>toNumber(b["Rating"]) - toNumber(a["Rating"]));

  FILTERED = list;
  renderGrid();
  const fc = document.getElementById("filtersCount");
  fc.textContent = ALL_PRODUCTS.length ? `Showing ${FILTERED.length} of ${ALL_PRODUCTS.length} products` : "";
}

function renderGrid(){
  const grid = document.getElementById("grid");
  const empty = document.getElementById("emptyState");
  grid.innerHTML = "";
  if(!FILTERED.length){ empty.style.display = "block"; return; }
  empty.style.display = "none";

  FILTERED.forEach(p=>{
    const sku = p["SKU"]||"";
    const name = p["Name"]||"Product";
    const price = p["Price"]||"";
    const imgUrl = fixImage(p["Image URL 1"] || "");
    const stock = toNumber(p["Stock"]);
    const rating = p["Rating"];
    const reviewCount = p["Review Count"];

    const card = document.createElement("div"); card.className = "product-card";
    const imgWrap = document.createElement("div"); imgWrap.className = "product-img-wrap";

    if(imgUrl){
      const img = document.createElement("img"); img.className="product-img"; img.src = imgUrl; img.alt = name;
      imgWrap.appendChild(img);
    } else {
      const ph = document.createElement("div"); ph.style.height="140px"; ph.style.display="flex"; ph.style.alignItems="center"; ph.style.justifyContent="center"; ph.style.fontSize="28px"; ph.textContent="ðŸ›ï¸"; imgWrap.appendChild(ph);
    }

    const stockBadge = document.createElement("div"); stockBadge.className = "stock-badge";
    if(stock>0){ stockBadge.textContent = (stock<=5 ? `Low stock (${stock})` : "In stock"); if(stock<=5) stockBadge.style.background="rgba(245,158,11,0.96)"; }
    else { stockBadge.textContent = "Out of stock"; stockBadge.classList.add("out"); }
    imgWrap.appendChild(stockBadge);

    const heart = document.createElement("div"); heart.className = "wishlist-heart"; heart.innerHTML = "â™¡";
    heart.onclick = function(ev){ ev.stopPropagation(); heart.classList.toggle("active"); heart.innerHTML = heart.classList.contains("active") ? "â™¥" : "â™¡"; };
    imgWrap.appendChild(heart);

    const nameEl = document.createElement("div"); nameEl.className = "product-name"; nameEl.textContent = name;

    const priceRow = document.createElement("div"); priceRow.style.display="flex"; priceRow.style.justifyContent="space-between"; priceRow.style.alignItems="center";
    const priceEl = document.createElement("div"); priceEl.className="product-price"; priceEl.textContent = price ? "â‚¹"+price : "";
    const ratingEl = document.createElement("div"); ratingEl.className="rating-line"; ratingEl.textContent = rating ? `â˜… ${rating}` + (reviewCount ? ` (${reviewCount})` : "") : "New arrival";
    priceRow.appendChild(priceEl); priceRow.appendChild(ratingEl);

    const actions = document.createElement("div"); actions.className="product-actions";
    const btnKnow = document.createElement("a"); btnKnow.className="btn btn-outline"; btnKnow.textContent="Know More"; btnKnow.href=`product.html?sku=${encodeURIComponent(sku)}`;
    const btnBuy = document.createElement("a"); btnBuy.className="btn btn-primary"; btnBuy.textContent="Buy Now";
    btnBuy.href = `order.html?sku=${encodeURIComponent(sku)}&name=${encodeURIComponent(name)}&price=${encodeURIComponent(price)}&img=${encodeURIComponent(imgUrl)}`;

    actions.appendChild(btnKnow); actions.appendChild(btnBuy);

    // Compose card
    card.appendChild(imgWrap);
    card.appendChild(nameEl);
    card.appendChild(priceRow);
    card.appendChild(actions);

    card.addEventListener("click", e => {
      if(e.target.tagName === "A" || e.target.classList.contains("wishlist-heart")) return;
      window.location.href = `product.html?sku=${encodeURIComponent(sku)}`;
    });

    grid.appendChild(card);
  });
}

/* Event wiring */
document.addEventListener("DOMContentLoaded", ()=> {
  document.getElementById("searchInput").addEventListener("input", applyFilters);
  document.getElementById("categoryFilter").addEventListener("change", applyFilters);
  document.getElementById("sortFilter").addEventListener("change", applyFilters);
  document.getElementById("stockFilter").addEventListener("change", applyFilters);
  document.getElementById("minPrice").addEventListener("input", applyFilters);
  document.getElementById("maxPrice").addEventListener("input", applyFilters);

  // LOAD once
  loadProducts();
});
</script>
</body>
</html>