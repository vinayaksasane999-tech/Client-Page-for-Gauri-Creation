<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Product • Gauri Creations</title>
<style>
  :root{
    --bg: linear-gradient(135deg,#e3f2ff,#ffe5f3);
    --glass-strong: rgba(255,255,255,0.98);
    --glass-border: rgba(148,163,184,0.6);
    --accent-grad: linear-gradient(135deg,#2563eb,#ec4899);
    --muted: #6b7280;
  }
  *{box-sizing:border-box}
  body{margin:0;min-height:100vh;font-family:system-ui,-apple-system,'Poppins',sans-serif;background:var(--bg);padding:18px;display:flex;justify-content:center}
  .shell{width:100%;max-width:1100px}
  .top-hero{display:flex;gap:14px;margin-bottom:14px;align-items:center}
  .logo{width:84px;height:84px;border-radius:12px;object-fit:cover;box-shadow:0 12px 28px rgba(15,23,42,0.18)}
  .store-title{font-weight:800;font-size:20px}
  .store-sub{font-size:13px;color:var(--muted)}
  .product-grid{display:grid;grid-template-columns:1fr 420px;gap:16px}
  @media(max-width:980px){.product-grid{grid-template-columns:1fr}}
  .images-card{background:var(--glass-strong);border-radius:18px;padding:12px;border:1px solid var(--glass-border);box-shadow:0 18px 45px rgba(15,23,42,0.12)}
  .main-image-wrap{border-radius:12px;overflow:hidden;background:#fff;display:flex;align-items:center;justify-content:center;height:380px}
  .main-image{max-width:100%;max-height:100%;object-fit:contain;cursor:pointer}
  .thumbs{display:flex;gap:8px;margin-top:10px}
  .thumb{width:72px;height:72px;border-radius:10px;overflow:hidden;border:1px solid #e6e8ea;cursor:pointer;background:#fff;flex-shrink:0}
  .thumb img{width:100%;height:100%;object-fit:cover;display:block}
  .details-card{background:var(--glass-strong);border-radius:18px;padding:14px;border:1px solid var(--glass-border);box-shadow:0 18px 45px rgba(15,23,42,0.12);display:flex;flex-direction:column;gap:10px}
  .prod-name{font-size:20px;font-weight:800}
  .prod-sku{font-size:12px;color:var(--muted)}
  .price{font-weight:800;font-size:20px;color:#e11d48}
  .rating{font-size:13px;color:var(--muted)}
  .specs{font-size:13px;color:var(--muted);margin-top:6px}
  .actions{display:flex;gap:8px;margin-top:8px}
  .btn{border-radius:999px;border:none;padding:6px 10px;font-size:13px;cursor:pointer;font-weight:600;line-height:1.1}
  .btn-outline{background:#fff;border:1px solid #d1d5db;color:#111827}
  .btn-primary{background:var(--accent-grad);color:#fff}
  /* Lightbox */
  #lightboxOverlay{position:fixed;inset:0;background:rgba(0,0,0,0.85);display:none;align-items:center;justify-content:center;z-index:2000;backdrop-filter:blur(4px)}
  #lightboxImg{max-width:94%;max-height:94%;object-fit:contain;border-radius:12px}
  .muted{color:var(--muted)}
</style>
</head>
<body>
<div class="shell">
  <div class="top-hero">
    <img src="logo-gauri.jpeg" class="logo" alt="Gauri">
    <div>
      <div class="store-title">Gauri Creations</div>
      <div class="store-sub">Handcrafted decor • Secure UPI checkout</div>
    </div>
  </div>

  <div class="product-grid">
    <div class="images-card">
      <div class="main-image-wrap"><img id="mainImage" class="main-image" src="" alt="Product"></div>
      <div id="thumbs" class="thumbs"></div>
    </div>

    <div class="details-card">
      <div><div id="prodName" class="prod-name">Product name</div><div id="prodSku" class="prod-sku">SKU: -</div></div>

      <div style="display:flex;justify-content:space-between;align-items:center">
        <div id="prodPrice" class="price">₹0</div>
        <div id="prodRating" class="rating">★ -</div>
      </div>

      <div id="prodDesc" class="specs">Description...</div>

      <div class="actions">
        <button id="btnBuyNow" class="btn btn-primary">Buy Now</button>
        <button id="btnWhatsapp" class="btn btn-outline">Order on WhatsApp</button>
      </div>

      <div id="deliveryInfo" class="muted">Delivery: Calculated at order page</div>
    </div>
  </div>
</div>

<!-- lightbox -->
<div id="lightboxOverlay" onclick="if(event.target===this) closeLightbox()">
  <img id="lightboxImg" src="" alt="Zoomed">
</div>

<script>
/* single script URL used by your backend */
const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbwxlp4ehND6OHfGY9ruPptTs4euh3U-v3y6IA90EfmwjuiFZD4BnoHDjifKAPG9B1T7/exec";

/* Robust normalize: catches Drive ids including - _ and alphanums; returns lh3 googleusercontent serving link */
function normalizeMediaUrl(url){
  if(!url) return "";
  url = String(url).trim();
  if(url.includes("googleusercontent") || url.includes("lh3.googleusercontent.com")) return url;
  // match longer ids (20+ chars) allowing letters, numbers, - and _
  const m = url.match(/[-A-Za-z0-9_]{20,}/);
  if(m) return `https://lh3.googleusercontent.com/d/${m[0]}=w1000`;
  // if already uc view
  if(url.startsWith("https://drive.google.com/uc?export=view&id=")) return url;
  return url;
}

function getQueryParams(){
  const out = {};
  location.search.substring(1).split("&").forEach(pair=>{
    if(!pair) return;
    const [k,v] = pair.split("=");
    out[decodeURIComponent(k)] = decodeURIComponent(v||"");
  });
  return out;
}

let CURRENT_PRODUCT = null;

/* load product by sku */
async function loadProduct(){
  const qs = getQueryParams();
  const sku = qs.sku || "";
  if(!sku) return;
  try{
    const res = await fetch(SCRIPT_URL + "?action=getProduct&sku=" + encodeURIComponent(sku));
    const data = await res.json();
    if(!data || !data.success || !data.product){ console.warn('product not found'); return; }
    CURRENT_PRODUCT = data.product;
    populateProduct(CURRENT_PRODUCT);
  }catch(err){ console.error(err); }
}

/* render product */
function populateProduct(p){
  document.getElementById("prodName").textContent = p["Name"] || "Product";
  document.getElementById("prodSku").textContent = "SKU: " + (p["SKU"]||"");
  document.getElementById("prodPrice").textContent = p["Price"] ? ("₹" + p["Price"]) : "₹0";
  document.getElementById("prodDesc").textContent = p["Description"] || "";
  document.getElementById("prodRating").textContent = p["Rating"] ? ("★ " + p["Rating"]) : "New";

  const imgs = [];
  for(let i=1;i<=5;i++){
    const key = "Image URL " + i;
    if(p[key]) imgs.push(normalizeMediaUrl(p[key]));
  }

  const main = document.getElementById("mainImage");
  main.src = imgs[0] || "";
  main.alt = p["Name"] || "Product";

  const thumbs = document.getElementById("thumbs");
  thumbs.innerHTML = "";
  imgs.forEach((u, idx) => {
    const d = document.createElement("div"); d.className = "thumb";
    const im = document.createElement("img"); im.src = u; im.alt = `Img ${idx+1}`;
    im.addEventListener("click", (ev) => { ev.stopPropagation(); main.src = u; });
    d.appendChild(im); thumbs.appendChild(d);
  });

  main.onclick = () => { if(main.src) openLightbox(main.src); };

  // Buy now → direct to order.html with params
  document.getElementById("btnBuyNow").onclick = () => {
    const name = encodeURIComponent(p["Name"] || "");
    const price = encodeURIComponent(p["Price"] || "");
    const img = encodeURIComponent(imgs[0] || "");
    const sku = encodeURIComponent(p["SKU"] || "");
    window.location.href = `order.html?product=${name}&price=${price}&img=${img}&sku=${sku}`;
  };

  // WhatsApp
  document.getElementById("btnWhatsapp").onclick = () => {
    const phone = "7745092723";
    const msg = `Hello Gauri Creations, I want to order: Product: ${p["Name"]||''} | SKU: ${p["SKU"]||''} | Price: ₹${p["Price"]||''}`;
    window.open(`https://wa.me/${phone}?text=${encodeURIComponent(msg)}`, "_blank");
  };
}

/* lightbox functions */
function openLightbox(url){ document.getElementById("lightboxImg").src = url; document.getElementById("lightboxOverlay").style.display = 'flex'; }
function closeLightbox(){ document.getElementById("lightboxOverlay").style.display = 'none'; }

document.addEventListener("DOMContentLoaded", loadProduct);
</script>
</body>
</html>